<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  id="Definitions_CoffeeChain_POS"
                  targetNamespace="http://bpmn.io/schema/bpmn">

  <bpmn:process id="CoffeeChainProcess" isExecutable="true">

    <!-- Start Event -->
    <bpmn:startEvent id="StartEvent_Coffee" name="Start Coffee Chain Setup">
      <bpmn:outgoing>Flow_Start_CreateOutlet</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- Create Coffee Outlet -->
    <bpmn:task id="Task_CreateOutlet" name="Create Coffee Outlet">
      <bpmn:incoming>Flow_Start_CreateOutlet</bpmn:incoming>
      <bpmn:outgoing>Flow_CreateOutlet_CRM</bpmn:outgoing>
    </bpmn:task>

    <!-- CRM Task -->
    <bpmn:task id="Task_CRM" name="Add to CRM">
      <bpmn:incoming>Flow_CreateOutlet_CRM</bpmn:incoming>
      <bpmn:outgoing>Flow_CRM_SalesOrder</bpmn:outgoing>
    </bpmn:task>

    <!-- Sales Order -->
    <bpmn:task id="Task_SalesOrder" name="Create Sales Order">
      <bpmn:incoming>Flow_CRM_SalesOrder</bpmn:incoming>
      <bpmn:outgoing>Flow_SalesOrder_POS</bpmn:outgoing>
    </bpmn:task>

    <!-- POS (merged) -->
    <bpmn:subProcess id="SubProcess_POS" name="POS">
      <bpmn:incoming>Flow_SalesOrder_POS</bpmn:incoming>
      <bpmn:outgoing>Flow_POS_Payment</bpmn:outgoing>

      <!-- Inside POS: Decision -->
      <bpmn:startEvent id="POS_Start" name="Select POS Type">
        <bpmn:outgoing>POSFlow_Decision</bpmn:outgoing>
      </bpmn:startEvent>

      <bpmn:exclusiveGateway id="Gateway_POSChoice" name="POS Type?">
        <bpmn:incoming>POSFlow_Decision</bpmn:incoming>
        <bpmn:outgoing>POSFlow_Shop</bpmn:outgoing>
        <bpmn:outgoing>POSFlow_Restaurant</bpmn:outgoing>
      </bpmn:exclusiveGateway>

      <bpmn:task id="Task_POSShop" name="POS Shop">
        <bpmn:incoming>POSFlow_Shop</bpmn:incoming>
        <bpmn:outgoing>POSFlow_Merge</bpmn:outgoing>
      </bpmn:task>

      <bpmn:task id="Task_POSRestaurant" name="POS Restaurant">
        <bpmn:incoming>POSFlow_Restaurant</bpmn:incoming>
        <bpmn:outgoing>POSFlow_Merge</bpmn:outgoing>
      </bpmn:task>

      <bpmn:exclusiveGateway id="Gateway_POSMerge">
        <bpmn:incoming>POSFlow_Merge</bpmn:incoming>
        <bpmn:outgoing>POSFlow_Payment</bpmn:outgoing>
      </bpmn:exclusiveGateway>

      <bpmn:sequenceFlow id="POSFlow_Decision" sourceRef="POS_Start" targetRef="Gateway_POSChoice"/>
      <bpmn:sequenceFlow id="POSFlow_Shop" sourceRef="Gateway_POSChoice" targetRef="Task_POSShop"/>
      <bpmn:sequenceFlow id="POSFlow_Restaurant" sourceRef="Gateway_POSChoice" targetRef="Task_POSRestaurant"/>
      <bpmn:sequenceFlow id="POSFlow_Merge" sourceRef="Task_POSShop" targetRef="Gateway_POSMerge"/>
      <bpmn:sequenceFlow id="POSFlow_Merge2" sourceRef="Task_POSRestaurant" targetRef="Gateway_POSMerge"/>
      <bpmn:sequenceFlow id="POSFlow_Payment" sourceRef="Gateway_POSMerge" targetRef="EndEvent_POS"/>

      <bpmn:endEvent id="EndEvent_POS" name="POS Complete">
        <bpmn:incoming>POSFlow_Payment</bpmn:incoming>
      </bpmn:endEvent>
    </bpmn:subProcess>

    <!-- Payment -->
    <bpmn:task id="Task_Payment" name="Process Payment">
      <bpmn:incoming>Flow_POS_Payment</bpmn:incoming>
      <bpmn:outgoing>Flow_Payment_End</bpmn:outgoing>
    </bpmn:task>

    <!-- End Event -->
    <bpmn:endEvent id="EndEvent_Coffee" name="Setup Complete">
      <bpmn:incoming>Flow_Payment_End</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_Start_CreateOutlet" sourceRef="StartEvent_Coffee" targetRef="Task_CreateOutlet"/>
    <bpmn:sequenceFlow id="Flow_CreateOutlet_CRM" sourceRef="Task_CreateOutlet" targetRef="Task_CRM"/>
    <bpmn:sequenceFlow id="Flow_CRM_SalesOrder" sourceRef="Task_CRM" targetRef="Task_SalesOrder"/>
    <bpmn:sequenceFlow id="Flow_SalesOrder_POS" sourceRef="Task_SalesOrder" targetRef="SubProcess_POS"/>
    <bpmn:sequenceFlow id="Flow_POS_Payment" sourceRef="SubProcess_POS" targetRef="Task_Payment"/>
    <bpmn:sequenceFlow id="Flow_Payment_End" sourceRef="Task_Payment" targetRef="EndEvent_Coffee"/>

  </bpmn:process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_CoffeeChain">
    <bpmndi:BPMNPlane id="BPMNPlane_CoffeeChain" bpmnElement="CoffeeChainProcess">

      <!-- Shapes for main process elements -->
      <bpmndi:BPMNShape id="StartEvent_Coffee_di" bpmnElement="StartEvent_Coffee">
        <dc:Bounds x="100" y="100" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Task_CreateOutlet_di" bpmnElement="Task_CreateOutlet">
        <dc:Bounds x="200" y="90" width="100" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Task_CRM_di" bpmnElement="Task_CRM">
        <dc:Bounds x="350" y="90" width="100" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Task_SalesOrder_di" bpmnElement="Task_SalesOrder">
        <dc:Bounds x="500" y="90" width="100" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="SubProcess_POS_di" bpmnElement="SubProcess_POS">
        <dc:Bounds x="650" y="70" width="300" height="200"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Task_Payment_di" bpmnElement="Task_Payment">
        <dc:Bounds x="980" y="110" width="120" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="EndEvent_Coffee_di" bpmnElement="EndEvent_Coffee">
        <dc:Bounds x="1150" y="115" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- Sequence Flows main process -->
      <bpmndi:BPMNEdge id="Flow_Start_CreateOutlet_di" bpmnElement="Flow_Start_CreateOutlet">
        <di:waypoint x="136" y="118"/>
        <di:waypoint x="200" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_CreateOutlet_CRM_di" bpmnElement="Flow_CreateOutlet_CRM">
        <di:waypoint x="300" y="115"/>
        <di:waypoint x="350" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_CRM_SalesOrder_di" bpmnElement="Flow_CRM_SalesOrder">
        <di:waypoint x="450" y="115"/>
        <di:waypoint x="500" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_SalesOrder_POS_di" bpmnElement="Flow_SalesOrder_POS">
        <di:waypoint x="600" y="115"/>
        <di:waypoint x="650" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_POS_Payment_di" bpmnElement="Flow_POS_Payment">
        <di:waypoint x="950" y="115"/>
        <di:waypoint x="980" y="135"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_Payment_End_di" bpmnElement="Flow_Payment_End">
        <di:waypoint x="1100" y="135"/>
        <di:waypoint x="1150" y="135"/>
      </bpmndi:BPMNEdge>

      <!-- SubProcess POS inner elements -->

      <bpmndi:BPMNShape id="POS_Start_di" bpmnElement="POS_Start">
        <dc:Bounds x="670" y="90" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Gateway_POSChoice_di" bpmnElement="Gateway_POSChoice">
        <dc:Bounds x="720" y="90" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Task_POSShop_di" bpmnElement="Task_POSShop">
        <dc:Bounds x="780" y="50" width="100" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Task_POSRestaurant_di" bpmnElement="Task_POSRestaurant">
        <dc:Bounds x="780" y="130" width="100" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="Gateway_POSMerge_di" bpmnElement="Gateway_POSMerge">
        <dc:Bounds x="910" y="90" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="EndEvent_POS_di" bpmnElement="EndEvent_POS">
        <dc:Bounds x="970" y="105" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- Subprocess sequence flows -->

      <bpmndi:BPMNEdge id="POSFlow_Decision_di" bpmnElement="POSFlow_Decision">
        <di:waypoint x="706" y="108"/>
        <di:waypoint x="720" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="POSFlow_Shop_di" bpmnElement="POSFlow_Shop">
        <di:waypoint x="770" y="115"/>
        <di:waypoint x="780" y="75"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="POSFlow_Restaurant_di" bpmnElement="POSFlow_Restaurant">
        <di:waypoint x="770" y="115"/>
        <di:waypoint x="780" y="155"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="POSFlow_Merge_di" bpmnElement="POSFlow_Merge">
        <di:waypoint x="880" y="75"/>
        <di:waypoint x="910" y="115"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="POSFlow_Merge2_di" bpmnElement="POSFlow_Merge2">
        <di:waypoint x="880" y="180"/>
        <di:waypoint x="910" y="140"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="POSFlow_Payment_di" bpmnElement="POSFlow_Payment">
        <di:waypoint x="960" y="115"/>
        <di:waypoint x="970" y="123"/>
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn:definitions>

